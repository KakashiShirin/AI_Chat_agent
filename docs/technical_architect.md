Of course. Here is the consolidated technical architecture specification. This document provides a complete technical blueprint for the project and should be used as the primary guide for all subsequent development phases.

-----

## AI Data Agent: Technical Architecture Specification

**Version:** 1.0  
**Date:** September 26, 2025  
**Author:** BMad Agent (Architect)  
**Status:** Approved for Development

### 1\. Overview

This document outlines the complete technical architecture and implementation plan for the **AI Data Agent** project. It is based on the approved Product Requirements Document (PRD v1.1) and is intended to guide the development team.

### 2\. High-Level System Architecture

The system will be a **decoupled, three-tier application**. This modern architecture separates concerns, allowing for parallel development and easier maintenance.

  * **Client (Frontend)**: A React Single Page Application (SPA) responsible for the user interface and user interactions.
  * **Server (Backend)**: A high-performance Python REST API built with FastAPI, containing all core business and AI logic.
  * **Database (Persistence)**: A PostgreSQL database instance hosting the specified e-commerce dataset.

-----

### 3\. Frontend Specification (Client)

  * **Framework**: **React** (initialized with **Vite** for a faster development experience).
  * **UI Component Library**: **MUI (Material-UI)** will be used for pre-built components and a consistent design, accelerating UI development.
  * **Key Libraries**:
      * `axios`: For robust and easy-to-use communication with the backend API.
      * `recharts`: For rendering dynamic and responsive data visualizations.
  * **Core Components**:
      * `ChatWindow.jsx`: Manages the overall conversation state.
      * `MessageList.jsx`: Renders the history of user queries and agent responses.
      * `UserInput.jsx`: A controlled form for submitting new questions.
      * `ResponseDisplay.jsx`: A container to render the complete agent response, including the summary, chart, and table.
      * `Chart.jsx`: A dynamic component that uses Recharts to render the specific visualization (`<BarChart>`, `<LineChart>`, etc.) requested by the backend.

-----

### 4\. Backend Specification (Server)

  * **Framework**: **Python** with **FastAPI** for its high performance, asynchronous capabilities, and automatic API documentation.
  * **Database Interaction**: **SQLAlchemy Core** with the `asyncpg` driver will be used to execute the raw, complex SQL queries generated by the AI model. An async connection pool will be managed for efficiency.
  * **AI Model Integration**: The core logic resides in the **AI Service Module**.
    1.  **Schema Introspection**: On startup, the service will generate `CREATE TABLE` statements for all tables in the Olist schema to provide essential context to the language model.
    2.  **Prompt Engineering**: A detailed prompt will be constructed for each user query, containing the full database schema and the user's question, to guide the AI in generating accurate SQL.
    3.  **Model**: A pre-trained **T5-based Text-to-SQL model** will be loaded using the Hugging Face `transformers` library.
  * **Project Structure**:
    ```
    /
    ├── api/
    │   └── main.py       # FastAPI app entry point
    ├── models/
    │   └── schemas.py    # Pydantic request/response models
    ├── services/
    │   ├── ai_service.py # Text-to-SQL generation logic
    │   └── db_service.py # Database connection and execution logic
    └── requirements.txt
    ```

-----

### 5\. Database Specification

  * **System**: **PostgreSQL**.
  * **Dataset**: **Brazilian E-Commerce Public Dataset by Olist**. This dataset's 9 interconnected tables provide the necessary complexity to meet the project's core challenge.

-----

### 6\. API Contract (Interface Definition)

A strict contract ensures seamless integration between the frontend and backend.

  * **Endpoint**: `POST /api/ask`
  * **Request Body**:
    ```json
    {
      "question": "string"
    }
    ```
  * **Success Response (200 OK) Body**:
    ```json
    {
      "summary": "string",
      "visualization": {
        "type": "string", // e.g., "bar_chart", "line_chart"
        "data": "array",    // Data formatted for Recharts
        "dataKey": "string",  // Key for the x-axis/labels
        "barKey": "string"    // Key for the y-axis/values
      },
      "tableData": {
        "columns": ["string"],
        "rows": [[]]
      }
    }
    ```

-----

### 7\. Deployment Strategy

  * **Platform**: **Vercel**.
  * **Methodology**: The React application will be deployed as a static site. The FastAPI application will be deployed as a serverless function. Vercel's routing rules will direct requests starting with `/api/` to the Python backend.
 